<root>
	<styles>
		<include src="file://{resources}/styles/steamstyles.css" />
					<include src="https://steamstore-a.akamaihd.net/public/css/bigpicture/eventbackground.css?v=9ie-lmHRI6VJ" />
			</styles>

			<script>
			function AdjustBowStyle()
			{
				var pMainMenu = $.TenfootController($.GetContextPanel()).AccessMainMenu();
				if (!pMainMenu)
					return;

				var pStoreBtn = pMainMenu.FindChildInLayoutFile('StoreButton');
				if (!pStoreBtn)
					return;

				var pBow = pStoreBtn.FindChild('Bow');
				if (!pBow)
					return;

				var bFocused = (pStoreBtn.BHasDescendantKeyFocus() || pStoreBtn.BHasKeyFocus());
				if ( bFocused || pStoreBtn.BHasHoverStyle() )
				{
					pBow.style.backgroundRepeat = 'no-repeat';
					pBow.style.backgroundPosition = '-5px -5px';
				}
				else
				{
					pBow.style.backgroundRepeat = 'no-repeat';
					pBow.style.backgroundPosition = '0px 0px';
				}
			}

			function InitMainMenu()
			{
				var pMainMenu = $.TenfootController( $.GetContextPanel() ).AccessMainMenu();
				if ( !pMainMenu )
					return;

				var pStoreBtn = pMainMenu.FindChildInLayoutFile( 'StoreButton' );
				if ( !pStoreBtn )
					return;

				var pBow = pStoreBtn.FindChild( 'Bow' );
				if ( !pBow )
				{
					pStoreBtn.BCreateChildren('<Panel id="Bow" style="width: 100%; height: 100%;" />');
					pBow = pStoreBtn.FindChild( 'Bow' );

					$.RegisterEventHandler( 'InputFocusSet', pStoreBtn, function ( pPanel )
					{
						AdjustBowStyle();
						return false;
					});

					$.RegisterEventHandler( 'InputFocusLost', pStoreBtn, function ( pPanel )
					{
						AdjustBowStyle();
						return false;
					});
				}

				pBow.style.backgroundColor = '#ff000000';
				pBow.style.backgroundRepeat = 'no-repeat';
				pBow.style.backgroundPosition = '0px 0px';
				pBow.style.backgroundImage = 'url( "https://steamcdn-a.akamaihd.net/store/winter2015/bigpicture/bow_main.png" )';

				AdjustBowStyle();
			}

			function InitContentFrame()
			{
				var pContentParent = $.TenfootController($.GetContextPanel()).GetContentParent();
				if ( !pContentParent )
					return;

				var pHeader = pContentParent.GetParent().FindChild( 'ContentFrameHeader' );
				if ( !pHeader )
					return;

				var pWrapper = pHeader.FindChild( 'SnowWrapper' );
				if ( !pWrapper )
				{
					pHeader.BCreateChildren( '<Panel id="SnowWrapper" style="width: 100%; height: 128px; padding: 5px 58px 0px 16px; flow-children: right;" />' );
					pWrapper = pHeader.FindChild( 'SnowWrapper' );
					if ( !pWrapper )
						return;

					while ( pHeader.GetChildCount() > 1 )
					{
						// wrapper was just added to end.. shouldn't be any panels after
						var pChild = pHeader.GetChild(0);
						if ( pChild == pWrapper )
							break;

						pChild.SetParent( pWrapper );
					}
				}

				pHeader.style.padding = '0px 0px 28px 0px';

				var strSnow = 'particle-system(	base-position( 960px, -400px ), base-position-variance( 1060px, 350px ), particle-size( 16px ), particle-size-variance( 7px ), particles-per-second( 20 ), particles-per-second-variance( 6 ), particle-lifespan-seconds( 26s ), particle-lifespan-seconds-variance( 6s ), particle-initial-velocity( 0px, 120px ), particle-initial-velocity-variance( 5px, 40px ), particle-velocity-min( -5px, 20px ), particle-velocity-max( 5px, 350px ), gravity-acceleration( 8px, -4px ), gravity-acceleration-particle-variance( 23px, 4px ), particle-start-color( #FFFFFF33 ), particle-start-color-variance( #00000022 ), particle-end-color( #FFFFFF00 ), particle-end-color-variance( #22222200 ), particle-sharpness( 0.5 ), particle-sharpness-variance( 0.3 ), particle-flicker( 0.0 ), particle-flicker-variance( 0.0 ) )';
				pWrapper.style.backgroundColor = strSnow;
			}

			$.Schedule( 0.0, function()
			{
				InitMainMenu();
				InitContentFrame();
			});

		</script>
	
	<EventBackground>
					<Panel class="Snow"></Panel>
		
	</EventBackground>
</root>
